---
title: "eda"
output: html_document
date: "2025-08-12"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(readr)
```

## **Contexto del conjunto de datos de enfermedad de c√°lculos biliares (Gallstone)**
Este conjunto de datos corresponde a un estudio cl√≠nico llevada a cabo entre junio de 2022 y junio de 2023, con la finalidad de detectar factores asociados a la presencia de colelitiasis (enfermedad de c√°lculos biliares) en pacientes que asistieron al centro m√©dico. La recolecci√≥n de datos variables cl√≠nicas, demogr√°ficas, fisiol√≥gicas y bioqu√≠micas, con el objetivo de desarrollar modelos capaces de predecir la presencia de esta patolog√≠a. 

El conjunto incluye 319 observaciones y 38 variables, que abarcan informaci√≥n como la edad, el g√©nero, el √≠ndice de masa corporal (IMC), mediciones de bioimpedancia, resultados de laboratorio (colesterol, glucosa, triglic√©ridos, etc.), y niveles de vitamina D, entre otros aspectos. Adem√°s se incorpora una variable binaria que se√±ala si el paciente fue o no diagnosticado con c√°lculos biliares.

A continuaci√≥n resaltamos las variables con mayor relevancia: 

* **age**: Edad del paciente (en a√±os).
* **sex**: Sexo del paciente (masculino/femenino).
* **height, weight**: Altura (cm) y peso (kg).
* **BMI**: √çndice de masa corporal.
* **fat_mass, muscle_mass**: Masa grasa y masa muscular.
* **visceral_fat_area**: √Årea de grasa visceral.
* **total_body_water**: Porcentaje de agua corporal.
* **protein**: Porcentaje de prote√≠na corporal.
* **glucose**: Nivel de glucosa.
* **cholesterol_total, HDL, LDL, triglycerides**: Perfil lip√≠dico.
* **AST, ALT, ALP**: Enzimas hep√°ticas.
* **vitamin_D**: Nivel de vitamina D.
* **creatinine, eGFR**: Funci√≥n renal.
* **CRP**: Prote√≠na C-reactiva.
* **comorbidity**: Presencia de enfermedades adicionales.
* **diagnosis**: Variable objetivo (presencia de c√°lculos biliares: 1 = s√≠, 0 = no).



El objetivo principal es analizar qu√© variables est√°n vinculadas con la presencia de c√°lculos biliares (diagnosis), con el fin de elaborar modelos predictivos que apoyen el diagn√≥stico cl√≠nico precoz. Este an√°lisis exploratorio de datos permitir√° entender la distribuci√≥n de las variables,  la identificaci√≥n de posibles patrones y con ello la relaci√≥n entre la condici√≥n de los pacientes y el diagn√≥stico de colelitiasis.

Iniciemos realizando un an√°lisis exploratorio de datos.

## **Extracci√≥n, transformaci√≥n y carga (ETL)**

*Cargue del conjunto de datos:

```{r correlacion, warning=FALSE, message=FALSE}
url <- "https://raw.githubusercontent.com/apaulag24/Metodos/refs/heads/main/Gallstone.csv"

datos <- read.csv(url, sep = ",", stringsAsFactors = TRUE)

head(datos,n=5)
dim(datos)
colnames(datos) #galstone status no es una variable
str(datos)

```
Notamos que los datos fueron cargados correctamente.

* Considerando que hay variables que se derivan de otras primarias, para facilitar el an√°lisis exploratorio y evitar redundancias o ruido en el modelo, se eliminar√°n las variables que presenten correlaci√≥n num√©rica positiva mayor de 0.85.*

## Including Plots

You can also embed plots, for example:

## An√°lisis de correlaci√≥n de variables num√©ricas

```{r correlacion, warning=FALSE, message=FALSE}
library(psych)
library(corrplot)

# Variables num√©ricas
datos_num <- datos[sapply(datos, is.numeric)]
datos_num <- na.omit(datos_num)

# Subconjunto con nombres corregidos seg√∫n tu dataset
subconjunto <- datos_num[, c("Body.Mass.Index..BMI.",
                             "Total.Body.Fat.Ratio..TBFR.....",
                             "Weight",
                             "Muscle.Mass..MM.",
                             "Total.Body.Water..TBW.",
                             "Body.Protein.Content..Protein.....")]

# Visualizaci√≥n con pairs.panels
pairs.panels(subconjunto,
             method = "pearson",
             hist.col = "#00BFC4",
             density = TRUE,
             ellipses = TRUE)

# Mostrar correlaciones fuertes
cor_matrix <- cor(datos_num)
high_cor <- which(abs(cor_matrix) > 0.85 & abs(cor_matrix) < 1, arr.ind = TRUE)

cat("Pares de variables con correlaci√≥n alta (r > 0.85):\n\n")
for (i in seq_len(nrow(high_cor))) {
  var1 <- rownames(cor_matrix)[high_cor[i, 1]]
  var2 <- colnames(cor_matrix)[high_cor[i, 2]]
  r <- round(cor_matrix[var1, var2], 2)
  cat(paste0("- ", var1, " vs ", var2, ": r = ", r, "\n"))
}


```{r pressure, echo=FALSE}


```
## An√°lisis de correlaci√≥n e identificaci√≥n de variables redundantes

A continuaci√≥n se muestran los pares de variables que presentan una **correlaci√≥n fuerte** (r > 0.85), lo que sugiere posible redundancia en la informaci√≥n:

| Variables comparadas                           | r     | Interpretaci√≥n                                      |
|------------------------------------------------|-------|-----------------------------------------------------|
| **Muscle Mass vs Total Body Water**            | 0.93  | Correlaci√≥n **muy fuerte**, casi duplicadas         |
| **Weight vs Muscle Mass**                      | 0.77  | Fuerte: m√°s peso ‚Üí m√°s masa muscular                |
| **Weight vs Total Body Water**                 | 0.77  | Fuerte: m√°s peso ‚Üí m√°s agua corporal                |
| **BMI vs Fat Ratio**                           | 0.79  | Fuerte: m√°s BMI ‚Üí m√°s grasa corporal                |
| **BMI vs Weight**                              | 0.75  | Fuerte: no sorprende, BMI depende directamente del peso |

### üßπ Recomendaci√≥n para evitar redundancia

Con base en estas correlaciones, se recomienda eliminar variables redundantes para simplificar el modelo y evitar colinealidad:

1. **Entre `Muscle Mass` y `Total Body Water` (r = 0.93):**  
   Estas dos variables est√°n muy correlacionadas. Puedes conservar **una** seg√∫n tu inter√©s:
   -                        Si el enfoque est√° en composici√≥n muscular: `Muscle.Mass..MM.`
   - Si el enfoque est√° en hidrataci√≥n corporal: `Total.Body.Water..TBW.`

2. **Entre `BMI`, `Weight`, y `Fat Ratio`:**  
   - Puedes conservar solo `Body.Mass.Index..BMI.`, que ya combina peso y altura.
   -                         `Total.Body.Fat.Ratio..TBFR.....` tambi√©n se correlaciona con BMI y puede eliminarse si no es indispensable.

### Eliminaci√≥n propuesta en R

```{r eliminar_variables}
# Eliminaci√≥n de variables redundantes

library(tidyverse)


datos %>% 
  select(-Muscle.Mass..MM., -Total.Body.Fat.Ratio..TBFR.....) -> df
```
